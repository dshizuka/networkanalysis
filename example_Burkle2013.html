<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Dai Shizuka" />


<title>Worked Example: Change in plant-pollinator network over 120 years</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Network Analysis in R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="tutorials.html">Tutorials</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Worked Example: Change in plant-pollinator
network over 120 years</h1>
<h4 class="author">Dai Shizuka</h4>
<h4 class="date">updated 01/06/23</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#recreating-figure-1"
id="toc-recreating-figure-1">Recreating Figure 1</a></li>
<li><a href="#recreating-figure-2"
id="toc-recreating-figure-2">Recreating Figure 2</a></li>
</ul>
</div>

<p>In 2009-2010, Laura Burkle and colleagues resampled a plant-bee
network that was originally sampled by Charles Robertson in the 1800s
(Robertson 1929). This allowed them to compare the mutualism network at
this site 120 years apart (Burkle et al. 2013)! What they found is
pretty astounding:</p>
<ul>
<li><p>Half of the bee species were locally extinct, leading to massive
loss of interactions. Many other interactions between plant species and
bee species that were still surviving also disappeared. In total, only
24% of the original interactions were intact.</p></li>
<li><p>However, there were also 121 new interactions that were not
observed by Robertson.</p></li>
<li><p>A lot of the loss of interactions were due to extinction of bee
species</p></li>
<li><p>A lot of other changes in the network edges occurred because of
the shift in phenology of plants and pollinators.</p></li>
<li><p>Across time, there can be massive rewiring of the mutualism
network.</p></li>
<li><p>This leads to big changes in network structure, such as
nestedness. Here, we will take the data presented in this paper to
reconstruct two key figures and one analysis. First, we will load the R
packages and the network data collected in 2009-2010, which is available
on Dryad: <a
href="http://datadryad.org/resource/doi:10.5061/dryad.rp321">http://datadryad.org/resource/doi:10.5061/dryad.rp321</a>.
We can import the data directly using the correct link address for the
.csv file:</p></li>
</ul>
<pre class="r"><code>library(igraph)
library(bipartite) 
new.el=read.csv(&quot;SampleData/Burkle2013/dryad - interactions now.csv&quot;)
head(new.el)</code></pre>
<pre><code>##                 plant             bee X.sum.ints
## 1  Dentaria_laciniata  Andrena_arabis          2
## 2 Claytonia_virginica Andrena_carlini         64
## 3  Dentaria_laciniata Andrena_carlini         17
## 4 Dicentra_cucullaria Andrena_carlini          3
## 5    Erigenia_bulbosa Andrena_carlini        118
## 6 Erythronium_albidum Andrena_carlini         14</code></pre>
<p>You can see that this data frame is an edge list–it has the two
connected nodes in two columns, and edge weights in a third column. We
will ignore the edge weights for this exercise because I don’t have
access to the edge weights for the Robertson’s original network (that
data was not deposited in the database).</p>
<p>I have, however, compiled the unweighted network from Robertson’s
original data using the published figure showing the interactions
between plant and bee species (Figure S9A). You can download that data,
as well as the ordering of the plant and bee species in that figure:</p>
<pre class="r"><code>old.el=read.csv(&quot;SampleData/Burkle2013/old_edgelist.csv&quot;)
head(old.el)</code></pre>
<pre><code>##                 plant                  bee edge
## 1 Claytonia_virginica Bombus_pensylvanicus    1
## 2  Geranium_maculatum Bombus_pensylvanicus    1
## 3 Isopyrum_biternatum Bombus_pensylvanicus    1
## 4  Dentaria_laciniata Bombus_pensylvanicus    1
## 5  Polemonium_reptans Bombus_pensylvanicus    1
## 6     Oxalis_violacea Bombus_pensylvanicus    1</code></pre>
<p>Let’s now convert both the new network and old network from edge
lists to interaction matrices, with plants on rows and bees on columns.
We can do this simply using the table() function and converting it to a
matrix (output not shown):</p>
<pre class="r"><code>new.bip=as.matrix(table(new.el[,1:2]))
old.bip=as.matrix(table(old.el[,1:2]))</code></pre>
<div id="recreating-figure-1" class="section level3">
<h3>Recreating Figure 1</h3>
<p>We will now use the ‘bipartite’ package to visualize the “old”
network from Robertson’s data:</p>
<pre class="r"><code>plotweb(old.bip, method=&quot;normal&quot;, text.rot=90) #method=&#39;normal&#39; preserves the order of species in matrix (currently alphabetical)</code></pre>
<p><img src="example_Burkle2013_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Now, let’s try to recreate Figure 1 of the paper, which is this
network colored by whether the bee species is now locally extinct (red
boxes), whether the interaction is gone because the bee species is gone
(red lines), or the interaction is gone for some other reason (blue
lines). First, we can figure out if the bee species is gone by comparing
the column names of the ‘old’ interaction matrix and the ‘new’
interaction matrix–if it is in the old but not the new, then it is gone
(output not shown).</p>
<pre class="r"><code>extinctbees=colnames(old.bip)[is.na(match(colnames(old.bip), colnames(new.bip)))] #the match function in the bracket returns NA if the name is in old network but not the new network. extinctbees</code></pre>
<p>We can use this list of bee species to color these boxes red in the
network plot:</p>
<pre class="r"><code>bee.colors=rep(&quot;black&quot;, length(colnames(old.bip))) 
bee.colors[match(extinctbees, colnames(old.bip))]=&#39;red&#39;
plotweb(old.bip, method=&quot;normal&quot;,text.rot=90, col.high=bee.colors)</code></pre>
<p><img src="example_Burkle2013_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>To color the lines, we have to first know that the plotweb() function
allows you to color the interactions using the argument
<code>col.interaction=</code>. First, let’s create an empty matrix for
the line colors where we will assign the colors. These will have row and
column names that correspond to the “old” interaction matrix.</p>
<pre class="r"><code>linecols=matrix(nrow=nrow(old.bip), ncol=ncol(old.bip), dimnames=dimnames(old.bip))</code></pre>
<p>We will now start assigning colors to interactions.</p>
<ol style="list-style-type: decimal">
<li><p>We will assign the color red to interactions that involve bee
species that do not appear in the new dataset (locally extinct). We will
do this by assigning the color ‘red’ to all interactions that correspond
to columns of bees that go locally extinct.</p></li>
<li><p>We will then color all interactions that occur in both old and
new datasets as black. To do this, we will construct a combined
interaction matrix using both the old AND new edge lists. The
interactions whose value = 2 in this combined matrix are interactions
that exist in both datasets.</p></li>
<li><p>We will color the remaining interactions blue–these are ones that
exist in the old network but do not exist in the new network, but do not
correspond to columns with extinct bees.</p></li>
<li><p>Finally, let’s set all of the interactions that actually do not
exist in the network to NA.</p></li>
</ol>
<pre class="r"><code>#color all columns with bees that will disappear in the new dataset = &quot;red&quot;
linecols[,match(extinctbees, colnames(linecols))]=&quot;red&quot;
#make combined interaction matrix, and interactions that have 2 = exist in both datasets = &quot;black&quot;
total.el=rbind(old.el[,1:2], new.el[,1:2])
total.bip=as.matrix(table(total.el$plant, total.el$bee)) 
linecols[which(total.bip==2)]=&quot;black&quot;
#the rest of the interactions will be colored &quot;blue&quot;
linecols[is.na(linecols)]=&quot;blue&quot;
#set the interactions that do not exist in the old network to NA
linecols[which(total.bip==0)]=NA
#now plot
plotweb(old.bip, method=&quot;normal&quot;,col.interaction=t(linecols), bor.col.interaction=t(linecols), text.rot=90, col.high=bee.colors)</code></pre>
<p><img src="example_Burkle2013_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>This looks almost exactly like Figure 1 in the paper. The main
differences come from the fact that the published figure includes edge
weights, but ours do not (because I did not have access to the edge
weight data from the ‘old network’).</p>
</div>
<div id="recreating-figure-2" class="section level3">
<h3>Recreating Figure 2</h3>
<p>Figure two is a colored matrix that displays similar information as
Figure 1, but with addition of new interactions (in yellow) that did not
exist in the old dataset but appear in the new dataset.</p>
<p>We can start this process using the ‘linecols’ matrix we created
above. The only information that this matrix lacks is the new
interactionsthe interactions that exists in the new network but not the
old network. We can figure out these interactions by using the combined
interaction matrix we created above (total.bip). If we set all values
&gt;0 in this matrix to 1 (i.e., convert all 2 to 1), and then subtract
it from the ‘old’ interaction matrix, then all the new interactions will
have the cell value = 1:</p>
<pre class="r"><code>total.bip[total.bip&gt;0]=1 
linecols[which(old.bip-total.bip==-1)]=&quot;yellow&quot;</code></pre>
<p>Now, we will convert this matrix of color names to numerics
corresponding to their color assignments as determined in base R (white
= 0, black = 1, red = 2, blue = 4, yellow = 7). Once we do that, we will
have to convert all of these cell values from “character” to
“numeric”.</p>
<pre class="r"><code>linecols[is.na(linecols)]=0
linecols[which(linecols==&quot;black&quot;)]=1
linecols[which(linecols==&quot;red&quot;)]=2
linecols[which(linecols==&quot;blue&quot;)]=4
linecols[which(linecols==&quot;yellow&quot;)]=7
linecols=matrix(as.numeric(linecols), nrow=nrow(old.bip), ncol=ncol(old.bip), dimnames=dimnames(old.bip))</code></pre>
<p>Finally, we want to re­order the rows and columns here to match the
figure, which is based on their “nestedness position” (Figure 2
caption). I actually could not re­create this because they do not explain
this ordering any further­­so I will have to cheat and simply import the
species order here as a separate .csv file:</p>
<pre class="r"><code>fig.order=read.csv(&quot;SampleData/Burkle2013/Fig2_order.csv&quot;) 
row.order=fig.order[match(rownames(linecols),fig.order$species), &quot;order&quot;]
col.order=fig.order[match(colnames(linecols),fig.order$species), &quot;order&quot;] 
linecols.ordered=linecols[order(row.order), order(col.order)] #matrix with the species sorted as in Figure2</code></pre>
<p>Now, we can use the visweb() function in bipartite package to
generate Figure 2</p>
<pre class="r"><code>colset=c(0, 1,2,4, 7) #sets the color according to cell values in increasing order 
visweb(linecols.ordered, &quot;none&quot;,square=&quot;defined&quot;, def.col=colset, clear=F) #def.cols= argument means use the defined color set</code></pre>
<p><img src="example_Burkle2013_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Let’s now calculate some specific numbers that tell us about the
changes in the plant-bee network at this location over 120 years. The
numbers here are very slightly different from what is reported in the
paper–I think this is due to the fact that there are two bee species in
Figure 2 of the paper that is not found in the dataset. I don’t know
where that discrepancy comes from, but it does not impact the result
very much. Here are some examples exploring the differences in the
networks (outputs not shown):</p>
<pre class="r"><code>table(linecols) # table showing frequencies of cell types </code></pre>
<pre><code>## linecols
##    0    1    2    4    7 
## 2172  121  182  230  129</code></pre>
<pre class="r"><code>table(linecols)[1]/sum(table(linecols)) #proportion of species pairs that never interact</code></pre>
<pre><code>##         0 
## 0.7664079</code></pre>
<pre class="r"><code>table(linecols)[2]/sum(table(linecols)[c(2,3,4)]) #proportion of interactions existing in old network that persisted to new network</code></pre>
<pre><code>##         1 
## 0.2270169</code></pre>
<pre class="r"><code>table(linecols)[5] #number of new interactions</code></pre>
<pre><code>##   7 
## 129</code></pre>
<pre class="r"><code>table(linecols)[5]/sum(table(linecols)[c(2,5)]) #proportion of new network links that were new.</code></pre>
<pre><code>##     7 
## 0.516</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
